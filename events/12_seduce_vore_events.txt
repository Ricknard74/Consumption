namespace = seduce_vore

# --- ONGOING EVENTS ---

# Event: A Tight Embrace (Milestone 1/2)
# The player offers a "massage" or "hug" that turns into being held inside the pred.
seduce_vore.1000 = {
    type = character_event
    title = seduce_vore.1000.t
    desc = seduce_vore.1000.desc
    theme = seduce_scheme
     
    left_portrait = {
        character = scope:target
        animation = personality_content
    }
    
    lower_right_portrait = {
        character = root
        animation = happiness
    }
    
    widget = {
        gui = "event_window_widget_scheme"
        container = "custom_widgets_container"
    }
    
    cooldown = { years = 2 }
    
    trigger = {
        NOT = { has_variable = scheme_event_active_flag }
        scope:target = { can_vore = yes }
        scope:owner = {
            can_be_prey = yes
        }
    }
    
    immediate = {
        set_variable = scheme_event_active_flag
        scope:target = {
            add_character_flag = portrait_belly
        }
    }
    
    # Accept the embrace
    option = {
        name = seduce_vore.1000.a
        
        # Successful interaction
        seduce_ongoing_add_scheme_modifier_effect = { MILESTONE = 1 OUTCOME = success }
        
        scope:owner = {
            add_character_modifier = {
                modifier = vore_seduced_warmth
                days = 30
            }
        }
        
        scope:target = {
            add_opinion = {
                target = scope:owner
                modifier = intimate_opinion
                opinion = 10
            }
        }
    }
    
    # Decline the event (for player choice)
    option = {
        name = seduce_vore.1000.b
        custom_tooltip = seduce_ongoing_decline_event.tt
        trigger = {
            is_ai = no
        }
        
        scope:scheme = {
            set_variable = {
                name = declined_seduce_milestone_1_event
                value = yes
            }
        }
    
    }
    
    after = {
        scope:target = { remove_character_flag = portrait_belly }
        remove_variable = scheme_event_active_flag
    }
}

# Event: Safe Resting (Milestone 1/2)
# The player (as predator) offers to hold the target inside them for "protection" or "warmth".
seduce_vore.1001 = {
    type = character_event
    title = seduce_vore.1001.t
    desc = seduce_vore.1001.desc
    theme = seduce_scheme
    
    left_portrait = {
        character = root
        animation = personality_compassionate
    }
    
    right_portrait = {
        character = scope:target
        animation = thinking
    }
    
    lower_left_portrait = root
    
    widget = {
        gui = "event_window_widget_scheme"
        container = "custom_widgets_container"
    }
    
    cooldown = { years = 2 }
    
    trigger = {
        NOT = { has_variable = scheme_event_active_flag }
        # Player must be the predator capable of holding someone
        can_vore = yes
        scope:target = {
            can_be_prey = yes
        }
    }
    
    immediate = {
        set_variable = scheme_event_active_flag
        # Add belly portrait flag to root (the pred)
        add_character_flag = {
            flag = portrait_belly
            days = 3
        }
    }
    
    # Offer the safe resting place
    option = {
        name = seduce_vore.1001.a
        
        # Show tooltip of possible outcomes
        custom_tooltip = seduce_vore.1001.a.tt
        
        hidden_effect = {
            # Determine if they accept based on their trust/traits
            random_list = {
                60 = {  # Base 60% success chance
                    modifier = {
                        add = -50
                        scope:target = { has_trait = shy }
                    }
                    modifier = {
                        add = 20
                        scope:target = { has_trait = lustful }
                    }
                    modifier = {
                        add = 20
                        scope:target = { has_trait = trusting }
                    }
                    modifier = {
                        add = -20
                        scope:target = { has_trait = paranoid }
                    }
                    
                    # Success: They accept the offer
                    seduce_ongoing_add_scheme_modifier_effect = { MILESTONE = 1 OUTCOME = success }
                    
                    scope:target = {
                        add_opinion = {
                            target = scope:owner
                            modifier = intimate_opinion
                            opinion = 15
                        }
                    }
                    
                    # Trigger follow-up flavor event
                    scope:owner = {
                        trigger_event = {
                            id = seduce_vore.1002
                            days = 1
                        }
                    }
                }
                40 = {  # 40% failure chance
                    # Failure: They are weirded out
                    scope:target = {
                        add_opinion = {
                            target = scope:owner
                            modifier = disappointed_opinion
                            opinion = -10
                        }
                    }
                    
                    # Trigger failure event
                    scope:owner = {
                        trigger_event = {
                            id = seduce_vore.1003
                            days = 1
                        }
                    }
                }
            }
        }
        
        ai_chance = {
            base = 100
        }
    }
    
    # Decline to offer (player choice)
    option = {
        name = seduce_vore.1001.b
        custom_tooltip = seduce_ongoing_decline_event.tt
        
        scope:scheme = {
            set_variable = {
                name = declined_seduce_milestone_1_event
                value = yes
            }
        }
        
        ai_chance = {
            base = 0
        }
    }
    
    after = {
        remove_variable = scheme_event_active_flag
        scope:owner = { remove_character_flag = portrait_belly }
    }
}

# Follow-up: Success - They enjoyed the rest
seduce_vore.1002 = {
    type = character_event
    title = seduce_vore.1001.t
    desc = seduce_vore.1002.desc
    theme = seduce_scheme
    
    left_portrait = {
        character = root
        animation = happiness
    }
    
    right_portrait = {
        character = scope:target
        animation = personality_content
    }
    
    trigger = {
        exists = scope:scheme
    }
    
    option = {
        name = seduce_vore.1002.a
        # Already got scheme progress in the first event
        stress_impact = {
            compassionate = minor_stress_impact_loss
            kind = minor_stress_impact_loss
        }
    }
}

# Follow-up: Failure - They were uncomfortable
seduce_vore.1003 = {
    type = character_event
    title = seduce_vore.1001.t
    desc = seduce_vore.1003.desc
    theme = seduce_scheme
    
    left_portrait = {
        character = root
        animation = embarrassed
    }
    
    right_portrait = {
        character = scope:target
        animation = dismissal
    }
    
    trigger = {
        exists = scope:scheme
    }
    
    option = {
        name = seduce_vore.1003.a
        # No scheme progress penalty - failure is penalty enough
        stress_impact = {
            arrogant = minor_stress_impact_gain
        }
    }
}

seduce_vore.1500 = {
    type = character_event
    title = seduce_vore.1500.t
    theme = seduction
    desc = seduce_vore.1500.d

    option = {
        name = seduce_vore.1500.
        scope:predator = {
            remove_character_flag = portrait_belly
        }
    }
}

# --- SUCCESS EVENTS (Outcomes) --- WIP

# Success: A Private Sanctuary
# The seduction concludes with the target climbing inside the player for the night.
# seduce_vore.2000 = {
#     type = character_event
#     title = seduce_vore.2000.t
#     theme = romance
#     desc = seduce_vore.2000.desc
    
#     trigger = {
#         NOT = { has_variable = scheme_event_active_flag }
#         can_vore = yes
#     }

#     immediate = {
#         # The intimacy of being the container
#         add_character_modifier = { modifier = vore_seduced_warmth days = 60 }
#     }

#     option = {
#         name = seduce_vore.2000.opt.a
        
#         hidden_effect = {
#             # We use a custom effect to "store" them temporarily without it being a prison sentence
#             # Or we use a very short "House Arrest" type to simulate the act
#             scope:target = {
#                 add_character_modifier = { modifier = hidden_in_stomach_romantic days = 1 }
#             }
#             scope:scheme = {
#                 end_scheme = yes
#             }
#             # Create a memory
#             create_character_memory = {
#                 type = romantic_vore_encounter
#                 participants = { partner = scope:target }
#             }
#         }
#     }

#     after = {
#         remove_variable = scheme_event_active_flag
#     }
# }

# # Success: Willing Prey
# # The target *wants* to be inside the player.
# seduce_vore.2001 = {
#     type = character_event
#     title = seduce_vore.2001.t
#     theme = romance
#     desc = seduce_vore.2001.desc
    
#     trigger = {
#         NOT = { has_variable = scheme_event_active_flag }
#         can_vore = yes
#         # Target is eager
#         scope:target = { has_trait = lustful }
#     }

#     option = {
#         name = seduce_vore.2001.opt.a
        
#         hidden_effect = {
#             safe_vore_effect = {
#                 type = oral
#                 prison_type = vore_willing # Keeps them in your court/dungeon safely
#             }
            
#             # Since this is seduction, we make the prison feel "romantic" via modifiers
#             scope:target = {
#                 add_character_modifier = { modifier = romantic_vore_captivity months = 2 }
#             }
            
#             add_diplomacy = 2 # Intimacy boosts
#         }
#     }

#     after = {
#         remove_variable = scheme_event_active_flag
#     }
# }